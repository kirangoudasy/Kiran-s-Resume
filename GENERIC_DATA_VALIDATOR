  srv.on('downloadTemplate', async (req) => {
    const { MODULE_NAME, SUB_MODULE_NAME, LOAD_TEMPLATE } = req.data;

    const tx = cds.transaction(req);
    const headers = await tx.run(

      SELECT.from('com.scb.fileupload.master.LoadMap')
        .columns('COLUMN_NAME', 'LOAD_COLUMN_SEQ')
        .where({
          MODULE_NAME: MODULE_NAME,
          SUB_MODULE_NAME: SUB_MODULE_NAME,
          LOAD_TEMPLATE: LOAD_TEMPLATE
        })
        .orderBy('LOAD_COLUMN_SEQ')
    );

    if (!headers.length) {
      req.reject(404, 'No columns found for given input');
    }

    const workbook = new ExcelJS.Workbook();

    const sheet = workbook.addWorksheet('template');


    const headerRow = headers.map(h => h.COLUMN_NAME);
    sheet.addRow(headerRow);


    const buffer = await workbook.xlsx.writeBuffer();
    const base64Content = buffer.toString('base64');

    return {
      FILE_NAME: `${MODULE_NAME}_${SUB_MODULE_NAME}_${LOAD_TEMPLATE}.xlsx`,
      FILE_MIME_TYPE: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
      FILE_CONTENT: base64Content
    };
  });
